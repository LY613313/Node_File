# 基于表单的暴力破解

# 一、代码审计

这一关的代码如下

```php+HTML
<?php
/**
 * Created by runner.han
 * There is nothing new under the sun
 */


$PIKA_ROOT_DIR =  "../../";

include_once $PIKA_ROOT_DIR.'inc/config.inc.php';
include_once $PIKA_ROOT_DIR.'inc/mysql.inc.php';

$SELF_PAGE = substr($_SERVER['PHP_SELF'],strrpos($_SERVER['PHP_SELF'],'/')+1);
if ($SELF_PAGE = "bf_form.php"){
    $ACTIVE = array('','active open','','active',"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","");

}

include_once $PIKA_ROOT_DIR.'header.php';

$link=connect();
$html="";

//典型的问题,没有验证码,没有其他控制措施,可以暴力破解
if(isset($_POST['submit']) && $_POST['username'] && $_POST['password']){

    $username = $_POST['username'];
    $password = $_POST['password'];
    $sql = "select * from users where username=? and password=md5(?)";
    $line_pre = $link->prepare($sql);


    $line_pre->bind_param('ss',$username,$password);

    if($line_pre->execute()){
        $line_pre->store_result();
        if($line_pre->num_rows>0){
            $html.= '<p> login success</p>';

        } else{
            $html.= '<p> username or password is not exists～</p>';
        }

    } else{
        $html.= '<p>执行错误:'.$line_pre->errno.'错误信息:'.$line_pre->error.'</p>';
    }

}



?>


<div class="main-content" xmlns="http://www.w3.org/1999/html">
    <div class="main-content-inner">
        <div class="breadcrumbs ace-save-state" id="breadcrumbs">
            <ul class="breadcrumb">
                <li>
                    <i class="ace-icon fa fa-home home-icon"></i>
                    <a href="burteforce.php">暴力破解</a>
                </li>
                <li class="active">基于表单的暴力破解</li>

            </ul><!-- /.breadcrumb -->
            <a href="#" style="float:right" data-container="body" data-toggle="popover" data-placement="bottom" title="tips(再点一下关闭)"
               data-content="这里一共有三个用户：
                admin/123456
                pikachu/000000
                test/abc123">
                点一下提示~
            </a>

        </div>
<div class="page-content">


<div class="bf_form">
    <div class="bf_form_main">
        <h4 class="header blue lighter bigger">
            <i class="ace-icon fa fa-coffee green"></i>
            Please Enter Your Information
        </h4>

        <form method="post" action="bf_form.php">
<!--            <fieldset>-->
                <label>
														<span>
															<input type="text" name="username" placeholder="Username" />
															<i class="ace-icon fa fa-user"></i>
														</span>
                </label>
                </br>

                <label>
														<span>
															<input type="password" name="password" placeholder="Password" />
															<i class="ace-icon fa fa-lock"></i>
														</span>
                </label>


                <div class="space"></div>

                <div class="clearfix">
                    <label><input class="submit" name="submit" type="submit" value="Login" /></label>
<!--                    <button type="button" name="submit">-->
<!--                        <i class="ace-icon fa fa-key"></i>-->
<!--                        <span class="bigger-110">Login</span>-->
<!--                    </button>-->
                </div>

        </form>
        <?php echo $html;?>


    </div><!-- /.widget-main -->

</div><!-- /.widget-body -->



</div><!-- /.page-content -->
</div>
</div><!-- /.main-content -->


<?php
include_once $PIKA_ROOT_DIR.'footer.php';
?>
```

可以看到典型的没有验证码没有次数限制，可以直接爆破

***

# 二、使用burpsuite进行爆破

先准备要爆破用的字典，一共两个，包括username和password的字典，如下

![image-20230303131629691](C:\Users\linyunong\Desktop\Note\pikachu靶场通关教程\暴力破解\images\image-20230303131629691.png)

![image-20230303131649404](C:\Users\linyunong\Desktop\Note\pikachu靶场通关教程\暴力破解\images\image-20230303131649404.png)

使用burp抓取登录时的数据包，右键选择send to intruder，如下

![image-20230303132026209](C:\Users\linyunong\Desktop\Note\pikachu靶场通关教程\暴力破解\images\image-20230303132026209.png)

attack type选择cluster bomb，payload positions的设置如下

![image-20230303132255605](C:\Users\linyunong\Desktop\Note\pikachu靶场通关教程\暴力破解\images\image-20230303132255605.png)

payload set 1选择simple list，点击load导入字典，如下

![image-20230303132511424](C:\Users\linyunong\Desktop\Note\pikachu靶场通关教程\暴力破解\images\image-20230303132511424.png)

payload set 2的设置同payload set 1，只是导入的是password的字典

![image-20230303132619615](C:\Users\linyunong\Desktop\Note\pikachu靶场通关教程\暴力破解\images\image-20230303132619615.png)

设置完毕后点击start attack即可开始爆破，等待爆破结束后对比返回数据长度，与其他不同的就是密码了

![image-20230303132850713](C:\Users\linyunong\Desktop\Note\pikachu靶场通关教程\暴力破解\images\image-20230303132850713.png)









